var councilData,listData,chart1,chart2,chart3,chart4,webURL="https://mapprod2.environment.nsw.gov.au/arcgis/rest/services/Planning/Planning_Portal_Application_Tracking/MapServer/1/query?f=json&orderByFields=COUNCIL_NAME, SUBMITTED_QUARTER ASC&outFields=*&returnGeometry=false&spatialRel=esriSpatialRelIntersects&where=SUBMITTED_QUARTER NOT IN ('2018 Q2','2018 Q3','2018 Q4') AND APPLICATION_TYPE IN ('All', 'Concurrence and Referral')",webURL2="https://mapprod2.environment.nsw.gov.au/arcgis/rest/services/Planning/Planning_Portal_Application_Tracking/MapServer/4/query?f=json&orderByFields=ORG_NAME , APPLICATION_TYPE ASC&outFields=APPLICATION_TYPE,ORGANISATION_TYPE,ORG_NAME&returnGeometry=false&spatialRel=esriSpatialRelIntersects&where=ORGANISATION_TYPE='COUNCIL' AND APPLICATION_TYPE IN ('Development Application', 'Concurrence and Referral')",submitted=[],lodged=[],determined=[],cnrSubmitted=[],cnrLodged=[],cnrDetermined=[],costDevelopment=[],avgDetermination=[];function drawChart1(){chart1=Highcharts.chart("container",{chart:{type:"column"},title:{text:"Number of applications by status",align:"center"},subtitle:{text:"Total number of applications in various stages for a particular council "},plotOptions:{column:{pointPadding:.1,groupPadding:.3,dataLabels:{enabled:!0}}},tooltip:{shared:!0,useHTML:!0},xAxis:{type:"category",crosshair:!0},yAxis:{min:0,title:{text:"Number of Applications"}},series:[{name:"Summitted",data:submitted},{name:"Lodged",data:lodged},{name:"Determined",data:determined}]})}function totalsInfographic(){$.each(submitted,function(t,e){if("All"===e[0]){var a=$("#totalApps");a.html(e[1]),animate(a)}}),$.each(cnrSubmitted,function(t,e){if("All"===e[0]){var a=$("#totalCnr");a.html(e[1]),animate(a)}})}function animate(t){var e=$(t);$({Counter:0}).animate({Counter:e.text()},{duration:1500,easing:"swing",step:function(){e.text(Math.ceil(this.Counter))}})}function updateCharts(){chart1.series[0].setData(submitted),chart1.series[1].setData(lodged),chart1.series[2].setData(determined),chart2.series[0].setData(costDevelopment),chart3.series[0].setData(avgDetermination),chart3.series[1].setData(determined),chart4.series[0].setData(cnrSubmitted),chart4.series[1].setData(cnrLodged),chart4.series[2].setData(cnrDetermined)}function chartType(t,e,a){switch(e){case"chart1":submitted.push([a,t.attributes.SUBMITTED_COUNT]),lodged.push([a,t.attributes.LODGEMENT_COUNT]),determined.push([a,t.attributes.DETERMINATION_COUNT]);break;case"chart2":costDevelopment.push([a,convertInt(t.attributes.COST_OF_DEVELOPMENT)]);break;case"chart3":null===t.attributes.AVERAGE_DETERMINATION_TIME?avgDetermination.push([a,0]):avgDetermination.push([a,t.attributes.AVERAGE_DETERMINATION_TIME]);break;case"chart4":cnrSubmitted.push([a,t.attributes.SUBMITTED_COUNT]),cnrLodged.push([a,t.attributes.LODGEMENT_COUNT]),cnrDetermined.push([a,t.attributes.DETERMINATION_COUNT])}}function convertInt(t){return parseInt(t)}function buildData(t,e,a,n){$.each(JSON.parse(t).features,function(t,r){if(n||(n="All"),r.attributes.COUNCIL_NAME===e&&r.attributes.APPLICATION_TYPE===n)switch(r.attributes.SUBMITTED_QUARTER){case"2019 Q1":case"2019 Q2":case"2019 Q3":case"All":chartType(r,a,r.attributes.SUBMITTED_QUARTER)}})}function buildListAll(t){var e=[],a=[];$.each(JSON.parse(t).features,function(t,n){"Development Application"===n.attributes.APPLICATION_TYPE&&e.push(n.attributes.ORG_NAME),"Concurrence and Referral"===n.attributes.APPLICATION_TYPE&&a.push(n.attributes.ORG_NAME)}),renderCouncilList(e,a)}function renderCouncilList(t,e){var a="",n="";$.each(t,function(t,e){a+="<li>"+e+"</li>"}),$.each(e,function(t,e){n+="<li>"+e+"</li>"}),$("#dalist").html(a),$("#cnrlist").html(n)}function buildDropdown(t){var e=[],a="<option value= 'All'>All</option>";$.each(JSON.parse(t).features,function(t,a){"All"==a.attributes.APPLICATION_TYPE&&e.push(a.attributes.COUNCIL_NAME)}),$.each(Array.from(new Set(e)),function(t,e){"All"!=e&&(a+="<option value='"+e+"'>"+e+"</option>")}),$("#councils").html(a)}function buildCnrDropdown(t){var e=[],a="<option value= 'All'>All</option>";$.each(JSON.parse(t).features,function(t,a){"Concurrence and Referral"==a.attributes.APPLICATION_TYPE&&e.push(a.attributes.COUNCIL_NAME)}),$.each(Array.from(new Set(e)),function(t,e){"All"!=e&&(a+="<option value='"+e+"'>"+e+"</option>")}),$("#cnrCouncils").html(a)}function spinner(t){$(t).html('<div class="spinner-border text-white" role="status"><span class="sr-only">Loading...</span> </div>')}function GetProjectType(){var t=$.Deferred();return spinner($("#totalApps")),$.ajax({url:webURL,type:"GET",headers:{Accept:"application/json;odata=verbose"}}).done(function(e){t.resolve(e)}),t.promise()}function GetCouncilList(){var t=$.Deferred();return spinner($("#totalCnr")),$.ajax({url:webURL2,type:"GET",headers:{Accept:"application/json;odata=verbose"}}).done(function(e){t.resolve(e)}),t.promise()}function drawChart2(){chart2=Highcharts.chart("container2",{chart:{type:"pie"},title:{text:"Total costs of development",align:"center"},xAxis:{type:"category",crosshair:!0},yAxis:{min:0,title:{text:"Total development costs"}},tooltip:{formatter:function(){return"The total costs for "+this.point.name+" is $"+numberConvert(this.y)}},plotOptions:{column:{allowPointSelect:!0,pointPadding:.3,dataLabels:{enabled:!0,formatter:function(){return"$"+numberConvert(this.y)}},showInLegend:!0}},series:[{name:"Total cost",data:costDevelopment}]})}function drawChart3(){chart3=Highcharts.chart("container3",{chart:{type:"spline"},title:{text:"Average determination time",align:"center"},xAxis:{type:"category",crosshair:!0},yAxis:[{min:0,title:{text:"Average determination time (in days)"}},{min:0,opposite:!0,title:{text:"Number of applications"}}],plotOptions:{column:{pointPadding:0,groupPadding:.2}},tooltip:{shared:!0,useHTML:!0},series:[{name:"Average determination days",data:avgDetermination,dataLabels:{enabled:!0,formatter:function(){return numberConvert(this.y)+" days"}}},{name:"Applications determined",data:determined,yAxis:1,dataLabels:{enabled:!0,formatter:function(){return numberConvert(this.y)}}}]})}function drawChart4(){chart4=Highcharts.chart("container4",{chart:{type:"column"},title:{text:"Concurrence and Referral case status",align:"center"},subtitle:{text:"Total number of Concurrence and Referrals in various stages for a particular council "},plotOptions:{column:{pointPadding:.1,groupPadding:.3,dataLabels:{enabled:!0}}},tooltip:{shared:!0,useHTML:!0},xAxis:{type:"category",crosshair:!0},yAxis:{min:0,title:{text:"Number of Applications"}},series:[{name:"Summitted",data:cnrSubmitted},{name:"Lodged",data:cnrLodged},{name:"Determined",data:cnrDetermined}]})}function numberConvert(t){return t>=1e9?(t/1e9).toFixed(1).replace(/\.0$/,"")+"B":t>=1e6?(t/1e6).toFixed(1).replace(/\.0$/,"")+"M":t>=1e3?(t/1e3).toFixed(1).replace(/\.0$/,"")+"K":t}$(document).ready(function(){GetProjectType().done(function(t){councilData=t,buildDropdown(t),buildCnrDropdown(t),buildData(t,"All","chart1"),buildData(t,"All","chart2"),buildData(t,"All","chart3"),buildData(t,"All","chart4","Concurrence and Referral"),totalsInfographic(),drawChart1(),drawChart2(),drawChart3(),drawChart4()}),GetCouncilList().done(function(t){listData=t,buildListAll(t)}),$("#councils").on("change",function(){var t=$(this).children("option:selected").val();submitted.length=0,lodged.length=0,determined.length=0,costDevelopment.length=0,avgDetermination.length=0,buildData(councilData,t,"chart1"),buildData(councilData,t,"chart2"),buildData(councilData,t,"chart3"),updateCharts()}),$("#cnrCouncils").on("change",function(){var t=$(this).children("option:selected").val();cnrSubmitted.length=0,cnrLodged.length=0,cnrDetermined.length=0,buildData(councilData,t,"chart4","Concurrence and Referral"),updateCharts()})});